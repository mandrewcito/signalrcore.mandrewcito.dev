---
import { getCollection } from 'astro:content';
import { icons } from '../lib/icons';

const featureEntries = await getCollection('features');
const features = await Promise.all(
  featureEntries
    .sort((a, b) => a.data.order - b.data.order)
    .map(async (entry) => ({
      data: entry.data,
      Content: (await entry.render()).Content,
    }))
);
---

<section class="features" id="features" aria-labelledby="features-title">
  <div class="container">
    <div class="section-header">
      <h2 id="features-title">Everything you need</h2>
      <p>A complete implementation of the SignalR protocol for Python</p>
    </div>
    <div class="features-grid">
      {features.map(({ data, Content }) => (
        <div class="feature-card">
          <div class={`feature-icon ${data.color}`}>
            <Fragment set:html={icons[data.icon] ?? ''} />
          </div>
          <h3>{data.title}</h3>
          <Content />
        </div>
      ))}
    </div>
  </div>
</section>
